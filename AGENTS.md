# 開発ルール・TODO

## 回答・UI
- 回答・UI・メッセージはすべて日本語
- 法令条文・根拠も日本語で明記

## 要件
- 建物情報入力フォーム
- 消防用設備の設置判定
- 判定理由・根拠の表示
- 入力バリデーション・エラーメッセージ

## 実装状況
- [x] UI基本構成
- [x] 10条・11条・12条ロジック
- [x] 消火器・屋内消火栓・スプリンクラー判定
- [x] テストケース拡充
- [x] App.vueのコンポーネント分割（入力フォーム・結果表示）
- [x] ESLint導入によるコード品質向上
- [x] 令第21条（自動火災報知設備）ロジック・テスト作成
- [x] 令第21条の2（ガス漏れ火災警報設備）ロジック・テスト作成
- [x] 令第22条（漏電火災警報器）ロジック・テスト作成
- [x] 令第23条（消防機関へ通報する火災報知設備）ロジック・テスト作成
- [x] 令第13条（水噴霧消火設備等）ロジック・テスト作成
- [x] 令第19条（屋外消火栓設備）ロジック・テスト作成
- [x] 令第24条（非常警報器具・設備）ロジック・テスト作成
- [x] 令第25条（避難器具）ロジック・テスト作成
- [x] 令第26条（誘導灯・誘導標識）ロジック・テスト作成
- [x] 令第27条（消防用水）ロジック・テスト作成
- [x] 令第28条（排煙設備）ロジック・テスト作成
- [x] 令第28条の2（連結散水設備）ロジック・テスト作成
- [x] 令第29条（連結送水管）ロジック・テスト作成
- [x] 令第29条の2（非常コンセント設備）ロジック・テスト作成
- [x] 令第29条の3（無線通信補助設備）ロジック・テスト作成
- [x] ファイル構成のリファクタリング（composables, tests）
- [x] コンポーザブルの入力型を定義し、依存関係を明確化
- [ ] 重複フォームの改善
- [ ] UI/UX改善
- [ ] 法改正・例外対応

## 今後の手順
1. 追加条文のロジックとテストを実装（令第13条, 19条, 24条...）
2. UI/UX改善（エラー表示・判定結果の強調）
3. README.md・AGENTS.mdの充実
4. 法改正・特殊ケース対応
5. ドキュメント・開発ルール整備

## ファイル構成と役割

- `eslint.config.ts`:
    - ESLintの設定ファイル。コードの静的解析ルールを定義します。

- `src/App.vue`:
    - アプリケーションのルートコンポーネント。
    - 全体のレイアウトを定義し、すべての入力データと計算結果の状態を一元管理します。
    - `BuildingInputStepper` と `ResultsPanel` を呼び出し、データを連携させます。

- `src/components/BuildingInputStepper.vue`:
    - 建物情報を入力するためのステップフォームです。
    - ユーザーからの入力を受け取り、`App.vue` へ通知することに専念します。

- `src/components/ResultsPanel.vue`:
    - 判定結果を表示するためのパネルです。
    - `App.vue` から渡されたデータを表示することに専念します。

- `src/composables/articles/article*Logic.ts`:
    - 各消防法（令第10条、11条など）の判定ロジックをカプセル化したファイル群です。
    - 純粋な計算処理を担当し、UIから分離されています。

- `src/tests/article*Logic.spec.ts`:
    - 各判定ロジックに対応するテストファイル群です。
    - `vitest` を使用して、ロジックの正当性を検証します。

- `src/composables/utils.ts`:
    - 判定ロジックで共通して使用されるヘルパー関数（用途コードのマッチングなど）をまとめたファイルです。

- `src/data/buildingUses.ts`:
    - 防火対象物の用途（例：「(1)項イ 劇場」）のデータです。

- `.Agents/json/article*.json`:
    - 構造化された条文のJSONファイル

## 変更履歴（簡易）

- 2025-09-29: 複数の UI と判定ロジックについて修正・整理を行いました。
    - `src/components/BuildingInputStepper.vue`
        - 第1ステップへ以下の入力を移動・統合しました：令第1条・第6条・第14条に関する追加入力（舞台部、介護関連、ラック式倉庫）および令第22条（特殊可燃構造に関する入力）。
        - `hasLodging` チェックボックスを step3 から step1 の（6）項ハ関連ブロックへ移動し、表示条件を `buildingUse.startsWith('item06_ha')` に限定しました。
        - `isCareDependentOccupancy` の表示を `useCodeMatches(buildingUse, ['item06_ro_2','item06_ro_4','item06_ro_5'])` の場合のみ表示するように変更しました。

    - `src/composables/articles/article12Logic.ts`
        - 令第12条の判定ブロックの評価順を見直し、実務的な推奨順（除外関係を優先）に並べ替えました。
            - 初期は条文順（1→2→3→4…）での評価でしたが、除外ルールに従い実務的には第3号／第4号等を早期に評価する方が正確になるため、ユーザー指定の推奨順に並べ替えを行いました（具体的並びはコミット参照）。
        - ロジックの内部条件は変更せず、評価順のみ移動しています。

    - テスト
        - `npm test`（Vitest）を実行し、既存のユニットテスト 213 件がすべてパスしました。

    - 注意点 / 次の作業候補
        - 令第12条の第9号に関する規定は実装が不明瞭な箇所があるため、条文に基づく追加実装およびテスト追加を推奨します。
        - ブラウザ上での UI 動作確認（dev サーバー起動）も推奨します。

